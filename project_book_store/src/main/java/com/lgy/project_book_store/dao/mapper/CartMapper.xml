<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lgy.project_book_store.dao.CartDAO">

    <!-- 장바구니 아이템 추가 -->
    <insert id="insertCartItem" parameterType="com.lgy.project_book_store.dto.CartDTO">
        INSERT INTO cart (cart_id, user_id, book_id, quantity, cart_date)
        VALUES (cart_seq.NEXTVAL, #{user_id}, #{book_id}, #{quantity}, SYSDATE)
    </insert>

    <!-- 특정 사용자의 장바구니 아이템 조회 -->
    <select id="selectCartItemByUserAndBook" parameterType="map" resultType="com.lgy.project_book_store.dto.CartDTO">
	    SELECT cart_id, user_id, book_id, quantity, cart_date
	    FROM cart
	    WHERE user_id = #{user_id} AND book_id = #{book_id}
	</select>

    <!-- 장바구니 아이템 수량 수정 -->
    <update id="updateCartQuantity" parameterType="com.lgy.project_book_store.dto.CartDTO">
        UPDATE cart
        SET quantity = #{quantity}
        WHERE cart_id = #{cart_id}
    </update>

    <!-- 장바구니 아이템 삭제 -->
    <delete id="deleteCartItem" parameterType="int">
        DELETE FROM cart WHERE cart_id = #{cart_id}
    </delete>

	<select id="selectCartWithBookByUserId" parameterType="string" resultMap="cartBookResultMap">
	    SELECT 
	        c.cart_id, c.user_id, c.book_id, c.quantity, c.cart_date,
	        b.book_title, b.book_writer, b.book_price, b.book_isbn
	    FROM cart c
	    JOIN book b ON c.book_id = b.book_id
	    WHERE c.user_id = #{user_id}
	    ORDER BY c.cart_date DESC
	</select>
	
	<resultMap id="cartBookResultMap" type="com.lgy.project_book_store.dto.CartDTO">
	    <id property="cart_id" column="cart_id"/>
	    <result property="user_id" column="user_id"/>
	    <result property="book_id" column="book_id"/>
	    <result property="quantity" column="quantity"/>
	    <result property="cart_date" column="cart_date"/>
	    <association property="book" javaType="com.lgy.project_book_store.dto.BookDTO">
	        <result property="book_title" column="book_title"/>
	        <result property="book_writer" column="book_writer"/>
	        <result property="book_price" column="book_price"/>
	        <result property="book_isbn" column="book_isbn"/>
	    </association>
	</resultMap>
	
</mapper>
