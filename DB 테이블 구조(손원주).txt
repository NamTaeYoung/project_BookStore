--장르
CREATE TABLE Genre (
    genre_id   NUMBER PRIMARY KEY,
    genre_name VARCHAR2(100) NOT NULL
);

--도서
CREATE TABLE Book (
    book_id     NUMBER PRIMARY KEY,
    book_title  VARCHAR2(200) NOT NULL,
    book_writer VARCHAR2(100) NOT NULL,
    book_pub    VARCHAR2(100),
    book_date   DATE,
    genre_id    NUMBER,  -- 장르 외래키
    book_price  NUMBER,
    book_count  NUMBER,
    book_comm   VARCHAR2(1000),
    book_isbn   VARCHAR2(50),
    book_image_path VARCHAR2(500),
    --(외래키 제약조건)
    CONSTRAINT fk_book_genre FOREIGN KEY (genre_id)
        REFERENCES Genre (genre_id)
);

--도서리스트
CREATE TABLE BookList (
    list_id  NUMBER PRIMARY KEY,
    book_id  NUMBER NOT NULL,
    --(외래키 제약조건)
    CONSTRAINT fk_booklist_book FOREIGN KEY (book_id)
        REFERENCES Book (book_id)
);

CREATE TABLE users (
    user_id             VARCHAR2(20) PRIMARY KEY,
    user_pw             VARCHAR2(100)NOT NULL,
    user_email          VARCHAR2(30) NOT NULL,
    user_email_chk      CHAR(1) DEFAULT 'N' NOT NULL,
    user_phone_num      VARCHAR2(20) NOT NULL,
    user_post_num       VARCHAR2(10),
    user_address        VARCHAR2(200),
    user_detail_address VARCHAR2(100),
    user_name           VARCHAR2(20) NOT NULL,
    user_nickname       VARCHAR2(20),
    user_pwd_reset      VARCHAR2(100),
    login_fail_count    NUMBER(1) DEFAULT 0,
    last_fail_time      DATE ,
    reg_date            DATE DEFAULT SYSDATE,
    last_login_date     DATE
);

--도서구매
CREATE TABLE BookBuy (
    buy_id        NUMBER PRIMARY KEY,
    book_id        NUMBER NOT NULL,
    user_id        VARCHAR2(20) NOT NULL,
    quantity        NUMBER DEFAULT 1,
    purchase_date  DATE DEFAULT SYSDATE,
    --(외래키 제약조건)
    CONSTRAINT fk_bookbuy_book FOREIGN KEY (book_id)
        REFERENCES Book (book_id),
    CONSTRAINT fk_bookbuy_user FOREIGN KEY (user_id)
        REFERENCES users (user_id)
);

--장바구니
CREATE TABLE cart (
    cart_id    NUMBER PRIMARY KEY,
    user_id    VARCHAR2(20) NOT NULL,
    book_id    NUMBER NOT NULL,
    quantity   NUMBER DEFAULT 1,
    cart_date  DATE DEFAULT SYSDATE,

    CONSTRAINT fk_cart_user
        FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_cart_book
        FOREIGN KEY (book_id)
        REFERENCES book(book_id)
        ON DELETE CASCADE
);

--장바구니 시퀀스
CREATE SEQUENCE cart_seq
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

--책구매 시퀀스
CREATE SEQUENCE bookbuy_seq
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;
